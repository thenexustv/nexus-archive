---
import { format } from "date-fns";
import Base from "../layouts/Base.astro";
import EpisodeCard from "../components/EpisodeCard.astro";
import { getAllEpisodes, getAllSeries, getAllPeople, SITE_TITLE } from "../data";

const episodes = getAllEpisodes();
const recentEpisodes = episodes.slice(0, 10);
const series = getAllSeries();
const people = getAllPeople();

const allDates = episodes.map((e) => new Date(e.createdAt).getTime());
const firstYear = format(new Date(Math.min(...allDates)), "yyyy");
const lastYear = format(new Date(Math.max(...allDates)), "yyyy");
---

<Base description="Podcasts from the Technological Convergence. A preserved archive of thenexus.tv with all episodes, series, and people.">
  <div class="space-y-12">
    <section>
      <h1 class="text-3xl font-bold">{SITE_TITLE}</h1>
      <p class="mt-2 text-gray-600 text-lg">Podcasts from the Technological Convergence</p>
      <p class="mt-3 text-gray-600">
        The Nexus podcasts discuss a variety of topics including consumer technology news, developer news,
        gaming news and occasionally scientific news. We love talking, learning and exploring the future.
      </p>
      <div class="mt-4 flex flex-wrap gap-4 text-sm text-gray-500">
        <span>{episodes.length.toLocaleString()} episodes</span>
        <span>&middot;</span>
        <span>{series.length} series</span>
        <span>&middot;</span>
        <span>{people.length} people</span>
        <span>&middot;</span>
        <span>{firstYear}&ndash;{lastYear}</span>
      </div>
      <div class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-900">
        <p>
          <strong>Archive Notice:</strong> thenexus.tv was a podcast network that ran from {firstYear} to {lastYear}.
          This site is a preserved archive of all episodes. No new content is being produced.
          <a href="/about/" class="underline hover:text-amber-700">Learn more &rarr;</a>
        </p>
      </div>
    </section>

    <section>
      <div class="flex items-baseline justify-between mb-4">
        <h2 class="text-xl font-semibold">Recent Episodes</h2>
        <a href="/episodes/" class="text-sm text-blue-600 hover:text-blue-800">
          All episodes &rarr;
        </a>
      </div>
      <div class="divide-y divide-gray-100">
        {recentEpisodes.map((ep) => <EpisodeCard episode={ep} />)}
      </div>
    </section>

    <section>
      <div class="flex items-baseline justify-between mb-4">
        <h2 class="text-xl font-semibold">Series</h2>
        <a href="/series/" class="text-sm text-blue-600 hover:text-blue-800">
          All series &rarr;
        </a>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {series.map((s) => (
          <a
            href={`/series/${s.slug}/`}
            class="block p-4 border border-gray-200 rounded-lg hover:border-gray-300 hover:bg-gray-50 transition-colors"
          >
            <div class="font-medium text-gray-900">{s.name}</div>
            <div class="mt-1 text-sm text-gray-500">
              {s.episodeCount} episode{s.episodeCount !== 1 ? "s" : ""}
            </div>
            {s.description && (
              <p class="mt-2 text-sm text-gray-600 line-clamp-2">{s.description}</p>
            )}
          </a>
        ))}
      </div>
    </section>
  </div>
</Base>
